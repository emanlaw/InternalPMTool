{% extends "base.html" %}

{% block content %}
<div style="max-width: 800px; margin: 0 auto;">
    <h1>ğŸ”¥ Firebase Database Management</h1>
    
    <div class="stats-grid" style="margin-bottom: 30px;">
        <div class="stat-card">
            <div class="stat-number" id="firebase-status">Checking...</div>
            <div class="stat-label">Firebase Status</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="users-count">-</div>
            <div class="stat-label">Users in Firebase</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="projects-count">-</div>
            <div class="stat-label">Projects in Firebase</div>
        </div>
        <div class="stat-card">
            <div class="stat-number" id="cards-count">-</div>
            <div class="stat-label">Cards in Firebase</div>
        </div>
    </div>
    
    <div class="project-card">
        <h3>ğŸ“Š Database Migration</h3>
        <p>Migrate your existing JSON data to Firebase Firestore for better performance and real-time updates.</p>
        
        <div style="margin: 20px 0;">
            <button onclick="checkFirebaseStatus()" class="btn" style="margin-right: 10px;">
                ğŸ” Check Firebase Status
            </button>
            <button onclick="migrateToFirebase()" class="btn" style="background: #ff6b35;">
                ğŸš€ Migrate to Firebase
            </button>
        </div>
        
        <div id="migration-result" style="margin-top: 20px; padding: 15px; border-radius: 6px; display: none;"></div>
    </div>
    
    <div class="project-card">
        <h3>âš™ï¸ Firebase Configuration</h3>
        <p>Make sure you have completed the Firebase setup:</p>
        <ul>
            <li>âœ… Created Firebase project</li>
            <li>âœ… Enabled Firestore database</li>
            <li>âœ… Downloaded service account key</li>
            <li>âœ… Updated firebase_config.py with your credentials</li>
            <li>âœ… Installed Firebase dependencies</li>
        </ul>
    </div>
    
    <div class="project-card">
        <h3>ğŸ”’ Security Rules</h3>
        <p>Don't forget to set up Firestore security rules for production:</p>
        <pre style="background: #f5f5f5; padding: 15px; border-radius: 6px; overflow-x: auto;">
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Users can read/write their own data
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // All authenticated users can read/write projects and cards
    match /{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
        </pre>
    </div>
</div>

<script>
async function checkFirebaseStatus() {
    try {
        const response = await fetch('/firebase-status');
        const data = await response.json();
        
        if (data.success) {
            document.getElementById('firebase-status').textContent = 'âœ… Connected';
            document.getElementById('users-count').textContent = data.data.users_count;
            document.getElementById('projects-count').textContent = data.data.projects_count;
            document.getElementById('cards-count').textContent = data.data.cards_count;
            
            showResult('Firebase is connected and working!', 'success');
        } else {
            document.getElementById('firebase-status').textContent = 'âŒ Error';
            showResult('Firebase connection failed: ' + data.error, 'error');
        }
    } catch (error) {
        document.getElementById('firebase-status').textContent = 'âŒ Error';
        showResult('Error checking Firebase status: ' + error.message, 'error');
    }
}

async function migrateToFirebase() {
    if (!confirm('This will migrate all your JSON data to Firebase. Continue?')) {
        return;
    }
    
    showResult('Migrating data to Firebase...', 'info');
    
    try {
        const response = await fetch('/migrate-to-firebase');
        const data = await response.json();
        
        if (data.success) {
            showResult('âœ… Data migrated to Firebase successfully!', 'success');
            checkFirebaseStatus(); // Refresh status
        } else {
            showResult('âŒ Migration failed: ' + data.message, 'error');
        }
    } catch (error) {
        showResult('âŒ Migration error: ' + error.message, 'error');
    }
}

function showResult(message, type) {
    const resultDiv = document.getElementById('migration-result');
    resultDiv.style.display = 'block';
    resultDiv.textContent = message;
    
    // Set colors based on type
    if (type === 'success') {
        resultDiv.style.background = '#e8f5e8';
        resultDiv.style.color = '#2e7d32';
        resultDiv.style.border = '1px solid #2e7d32';
    } else if (type === 'error') {
        resultDiv.style.background = '#ffebee';
        resultDiv.style.color = '#c62828';
        resultDiv.style.border = '1px solid #c62828';
    } else {
        resultDiv.style.background = '#e3f2fd';
        resultDiv.style.color = '#1565c0';
        resultDiv.style.border = '1px solid #1565c0';
    }
}

// Check status on page load
document.addEventListener('DOMContentLoaded', function() {
    checkFirebaseStatus();
});
</script>
{% endblock %}